parameters:
  - name: dockerType
    type: string
    default: ""

steps:
  - template: submodules.yaml

  - template: images/build.v2.yaml@templates
    parameters:
      arguments: ""
      dockerfile: deploy/${{ parameters.dockerType }}.Dockerfile
      registry: $(containerRegistry)
      repository: jrtc-${{ parameters.dockerType }}
      tags: |
        $(imageTag)
      preBuildScript: |
        IMAGE_NAME="jrtc-${{ parameters.dockerType }}"
        IMAGE_TAG="$(imageTag)"
        if docker image inspect $IMAGE_NAME:$IMAGE_TAG > /dev/null 2>&1; then
          echo "Image $IMAGE_NAME:$IMAGE_TAG already exists locally. Skipping build."
          exit 0
        else
          echo "Image $IMAGE_NAME:$IMAGE_TAG does not exist locally. Proceeding with build."
        fi
